<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>InkSight é…ç½®ç®¡ç†</title>
<style>
*{box-sizing:border-box;margin:0;padding:0}
:root{--bk:#1a1a1a;--gy:#888;--bg:#fafaf7;--bd:#d4d4cf}
body{font-family:'Inter',-apple-system,sans-serif;background:linear-gradient(135deg,#f5f5f0,#e8e8e0);color:var(--bk);line-height:1.6;min-height:100vh;padding:24px}
.container{max-width:800px;margin:0 auto}
.card{background:#fff;border-radius:20px;box-shadow:0 8px 40px rgba(0,0,0,.08);padding:32px;margin-bottom:20px}
h1{font-size:1.8rem;margin-bottom:8px}
.subtitle{color:var(--gy);font-size:.9rem;margin-bottom:24px}
.inp,.sel{width:100%;padding:10px 12px;font-size:.9rem;border:1px solid var(--bd);border-radius:8px;background:var(--bg);outline:none}
.inp:focus,.sel:focus{border-color:var(--bk)}
.fg{margin-bottom:16px}
.lbl{display:block;font-size:.85rem;font-weight:600;margin-bottom:6px}
.btn{padding:12px 24px;font-size:.9rem;font-weight:600;color:#fff;background:var(--bk);border:none;border-radius:10px;cursor:pointer}
.btn:hover{background:#333}
.btn:disabled{opacity:.6;cursor:not-allowed}
.cg{display:flex;flex-wrap:wrap;gap:8px}
.ch{padding:6px 12px;font-size:.8rem;border:1px solid var(--bd);border-radius:18px;cursor:pointer;background:#fff;color:var(--gy)}
.ch:hover{border-color:var(--bk);color:var(--bk)}
.ch.sel{background:var(--bk);color:#fff;border-color:var(--bk)}
.pg{display:flex;gap:8px}
.pi{flex:1;padding:8px;text-align:center;font-size:.8rem;border:1px solid var(--bd);border-radius:8px;cursor:pointer;background:#fff;color:var(--gy)}
.pi:hover{background:var(--bg)}
.pi.sel{background:var(--bk);color:#fff}
.alert{padding:12px 16px;border-radius:8px;margin-bottom:16px;font-size:.85rem}
.alert.success{background:#dcfce7;color:#15803d}
.alert.error{background:#fef2f2;color:#dc2626}
.alert.info{background:#dbeafe;color:#1e40af}
.hist-item{padding:12px;border:1px solid var(--bd);border-radius:8px;margin-bottom:8px;cursor:pointer;background:#fff}
.hist-item:hover{border-color:var(--bk);background:var(--bg)}
.hist-item.active{border-color:var(--bk);background:var(--bg)}
.hist-meta{font-size:.75rem;color:var(--gy);margin-bottom:6px}
.hist-content{font-size:.85rem;line-height:1.6}
.hist-actions{margin-top:8px;display:flex;gap:8px}
.hist-actions button{padding:4px 12px;font-size:.75rem;border:1px solid var(--bd);border-radius:6px;cursor:pointer;background:#fff}
.hist-actions button:hover{background:var(--bg)}
.tc{margin-bottom:6px}
.tcl{font-size:.68rem;color:var(--gy);margin-bottom:3px;font-weight:500}
</style>
</head>
<body>
<div class="container">
<div class="card">
<h1>InkSight é…ç½®ç®¡ç†</h1>
<p class="subtitle">åœ¨çº¿ä¿®æ”¹è®¾å¤‡é…ç½®ï¼Œæ— éœ€é‡æ–°è¿æ¥çƒ­ç‚¹</p>

<div id="alert" style="display:none"></div>

<div class="fg">
<label class="lbl">è®¾å¤‡ MAC åœ°å€</label>
<input type="text" class="inp" id="macIn" placeholder="ä¾‹å¦‚: 88:56:A6:7B:C7:0C">
<div style="font-size:.75rem;color:var(--gy);margin-top:4px">åœ¨è®¾å¤‡å±å¹•åº•éƒ¨æˆ–åˆå§‹é…ç½®é¡µé¢å¯ä»¥æ‰¾åˆ°ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ URL å‚æ•°ä¼ é€’</div>
</div>

<div style="display:flex;gap:8px">
<button class="btn" onclick="loadConfig()" id="loadBtn" style="flex:1">åŠ è½½å½“å‰é…ç½®</button>
<button class="btn" onclick="loadHistory()" id="historyBtn" style="flex:1;background:#6b7280">æŸ¥çœ‹å†å²é…ç½®</button>
</div>

<div id="historyList" style="display:none;margin-top:16px"></div>
</div>

<div id="configForm" style="display:none">
<div class="card">
<h2 style="font-size:1.3rem;margin-bottom:16px">è®¾å¤‡é…ç½®</h2>

<div class="fg">
<label class="lbl">æ˜µç§°</label>
<input type="text" class="inp" id="nickname" placeholder="å¯é€‰">
</div>

<div class="fg">
<label class="lbl">å†…å®¹æ¨¡å¼ï¼ˆå¤šé€‰ï¼‰</label>
<div class="cg" id="modes">
<span class="ch" data-m="STOIC" onclick="tc(this)">STOIC æ–¯å¤šè‘›</span>
<span class="ch" data-m="ROAST" onclick="tc(this)">ROAST æ¯’èˆŒ</span>
<span class="ch" data-m="ZEN" onclick="tc(this)">ZEN ç¦…æ„</span>
<span class="ch" data-m="DAILY" onclick="tc(this)">DAILY æ¯æ—¥</span>
<span class="ch" data-m="BRIEFING" onclick="tc(this)">BRIEFING ç®€æŠ¥</span>
<span class="ch" data-m="ARTWALL" onclick="tc(this)">ARTWALL ç”»å»Š</span>
<span class="ch" data-m="RECIPE" onclick="tc(this)">RECIPE é£Ÿè°±</span>
<span class="ch" data-m="FITNESS" onclick="tc(this)">FITNESS å¥èº«</span>
<span class="ch" data-m="POETRY" onclick="tc(this)">POETRY è¯—è¯</span>
<span class="ch" data-m="COUNTDOWN" onclick="tc(this)">COUNTDOWN å€’è®¡æ—¶</span>
</div>
</div>

<div class="fg">
<label class="lbl">åˆ·æ–°ç­–ç•¥</label>
<div class="pg" id="strategy">
<div class="pi" data-v="random" onclick="sp(this,'strategy')">éšæœºè½®æ¢</div>
<div class="pi" data-v="cycle" onclick="sp(this,'strategy')">å¾ªç¯è½®æ¢</div>
</div>
</div>

<div class="fg">
<label class="lbl">è¯­è¨€åå¥½</label>
<div class="pg" id="language">
<div class="pi" data-v="zh" onclick="sp(this,'language')">ä¸­æ–‡ä¸ºä¸»</div>
<div class="pi" data-v="en" onclick="sp(this,'language')">è‹±æ–‡ä¸ºä¸»</div>
<div class="pi" data-v="mixed" onclick="sp(this,'language')">ä¸­è‹±æ··åˆ</div>
</div>
</div>

<div class="fg">
<label class="lbl">å†…å®¹è°ƒæ€§</label>
<div class="pg" id="tone">
<div class="pi" data-v="positive" onclick="sp(this,'tone')">ç§¯æé¼“åŠ±</div>
<div class="pi" data-v="neutral" onclick="sp(this,'tone')">ä¸­æ€§å…‹åˆ¶</div>
<div class="pi" data-v="deep" onclick="sp(this,'tone')">æ·±æ²‰å†…çœ</div>
<div class="pi" data-v="humor" onclick="sp(this,'tone')">è½»æ¾å¹½é»˜</div>
</div>
</div>

<div class="fg">
<label class="lbl">è§’è‰²è¯­æ°”</label>
<div class="tc"><div class="tcl">æ–‡å­¦</div><div class="cg">
<span class="ch" data-t="é²è¿…" onclick="tc(this)">é²è¿…</span>
<span class="ch" data-t="ç‹å°æ³¢" onclick="tc(this)">ç‹å°æ³¢</span>
<span class="ch" data-t="å¼ çˆ±ç²" onclick="tc(this)">å¼ çˆ±ç²</span>
<span class="ch" data-t="æ‘ä¸Šæ˜¥æ ‘" onclick="tc(this)">æ‘ä¸Šæ˜¥æ ‘</span>
</div></div>
<div class="tc"><div class="tcl">å½±è§†</div><div class="cg">
<span class="ch" data-t="ç‹å®¶å«" onclick="tc(this)">ç‹å®¶å«</span>
<span class="ch" data-t="å‘¨æ˜Ÿé©°" onclick="tc(this)">å‘¨æ˜Ÿé©°</span>
<span class="ch" data-t="ç”„å¬›" onclick="tc(this)">ç”„å¬›</span>
<span class="ch" data-t="ç™½å±•å ‚" onclick="tc(this)">ç™½å±•å ‚</span>
</div></div>
<div class="tc"><div class="tcl">å“²å­¦</div><div class="cg">
<span class="ch" data-t="è‹æ ¼æ‹‰åº•" onclick="tc(this)">è‹æ ¼æ‹‰åº•</span>
<span class="ch" data-t="åº„å­" onclick="tc(this)">åº„å­</span>
<span class="ch" data-t="å°¼é‡‡" onclick="tc(this)">å°¼é‡‡</span>
</div></div>
<div class="tc"><div class="tcl">AI / ç§‘å¹»</div><div class="cg">
<span class="ch" data-t="JARVIS" onclick="tc(this)">JARVIS</span>
<span class="ch" data-t="æ™ºå­" onclick="tc(this)">æ™ºå­</span>
<span class="ch" data-t="é©¬æ–‡" onclick="tc(this)">é©¬æ–‡</span>
</div></div>
<div style="margin-top:6px">
<input type="text" class="inp" id="custTone" placeholder="æˆ–è‡ªå®šä¹‰ï¼šä¸œåŒ—å¤§çˆ·ã€å·æ™®...">
</div>
</div>

<div class="fg">
<label class="lbl">åœ°ç†ä½ç½®</label>
<input type="text" class="inp" id="city" placeholder="åŸå¸‚å">
</div>

<div class="fg">
<label class="lbl">AI æ¨¡å‹æä¾›å•†</label>
<select class="sel" id="llmProvider" onchange="updateModels()">
<option value="deepseek">Deepseek</option>
<option value="aliyun">é˜¿é‡Œç™¾ç‚¼</option>
<option value="moonshot">æœˆä¹‹æš—é¢</option>
</select>
</div>

<div class="fg">
<label class="lbl">AI æ¨¡å‹</label>
<select class="sel" id="llmModel"></select>
</div>

<div class="fg">
<label class="lbl">åˆ·æ–°é—´éš”ï¼ˆåˆ†é’Ÿï¼‰</label>
<input type="number" class="inp" id="interval" min="10" max="1440" placeholder="60">
</div>

<div class="fg" id="countdownSection">
<label class="lbl">å€’è®¡æ—¶äº‹ä»¶ï¼ˆCOUNTDOWN æ¨¡å¼ä½¿ç”¨ï¼‰</label>
<div id="countdownEvents"></div>
<button type="button" onclick="addCountdownEvent()" style="margin-top:8px;padding:6px 14px;font-size:.8rem;border:1px solid var(--bd);border-radius:6px;cursor:pointer;background:#fff">+ æ·»åŠ äº‹ä»¶</button>
<div style="font-size:.7rem;color:var(--gy);margin-top:4px">æœ€å¤š 10 ä¸ªäº‹ä»¶ï¼Œå€’è®¡æ—¶æ˜¾ç¤ºæœ€è¿‘ 3 ä¸ª</div>
</div>

<button class="btn" onclick="saveConfig()">ä¿å­˜é…ç½®</button>
</div>
</div>
</div>

<script>
const API_BASE = window.location.origin;

const llmModels = {
  deepseek: [{v:'deepseek-chat',n:'DeepSeek Chat'}],
  aliyun: [{v:'qwen-max',n:'é€šä¹‰åƒé—® Max'},{v:'qwen-plus',n:'é€šä¹‰åƒé—® Plus'},{v:'qwen-turbo',n:'é€šä¹‰åƒé—® Turbo'},{v:'deepseek-v3',n:'DeepSeek V3'},{v:'kimi-2.5',n:'Kimi 2.5'},{v:'glm-4-plus',n:'æ™ºè°± GLM-4 Plus'}],
  moonshot: [{v:'moonshot-v1-8k',n:'Kimi K1.5'},{v:'moonshot-v1-32k',n:'Kimi K1.5 32K'},{v:'kimi-k2-turbo-preview',n:'Kimi K2 Turbo'}]
};

function showAlert(msg, type) {
  const el = document.getElementById('alert');
  el.className = `alert ${type}`;
  el.textContent = msg;
  el.style.display = 'block';
  setTimeout(() => el.style.display = 'none', 5000);
}

function tc(el) {
  el.classList.toggle('sel');
}

function sp(el, group) {
  document.querySelectorAll(`#${group} .pi`).forEach(i => i.classList.remove('sel'));
  el.classList.add('sel');
}

function updateModels() {
  const provider = document.getElementById('llmProvider').value;
  const sel = document.getElementById('llmModel');
  sel.innerHTML = '';
  (llmModels[provider] || []).forEach(m => {
    const opt = document.createElement('option');
    opt.value = m.v;
    opt.textContent = m.n;
    sel.appendChild(opt);
  });
}

async function loadConfig() {
  const mac = document.getElementById('macIn').value.trim();
  if (!mac) {
    showAlert('è¯·è¾“å…¥ MAC åœ°å€', 'error');
    return;
  }

  try {
    const res = await fetch(`${API_BASE}/api/config/${mac}`);
    if (!res.ok) {
      showAlert('æœªæ‰¾åˆ°è¯¥è®¾å¤‡çš„é…ç½®', 'error');
      return;
    }

    const cfg = await res.json();
    fillForm(cfg);
    
    document.getElementById('configForm').style.display = 'block';
    document.getElementById('historyList').style.display = 'none';
    showAlert('é…ç½®åŠ è½½æˆåŠŸ', 'success');
  } catch (e) {
    showAlert('åŠ è½½å¤±è´¥: ' + e.message, 'error');
  }
}

async function loadHistory() {
  const mac = document.getElementById('macIn').value.trim();
  if (!mac) {
    showAlert('è¯·è¾“å…¥ MAC åœ°å€', 'error');
    return;
  }

  try {
    const res = await fetch(`${API_BASE}/api/config/${mac}/history`);
    if (!res.ok) {
      showAlert('æœªæ‰¾åˆ°å†å²é…ç½®', 'error');
      return;
    }

    const data = await res.json();
    const configs = data.configs || [];
    
    if (configs.length === 0) {
      showAlert('æš‚æ— å†å²é…ç½®', 'info');
      return;
    }

    const historyList = document.getElementById('historyList');
    historyList.innerHTML = '<h3 style="font-size:1.1rem;margin-bottom:12px">å†å²é…ç½®</h3>';
    
    configs.forEach((cfg, idx) => {
      const isActive = cfg.is_active === 1;
      const date = new Date(cfg.created_at).toLocaleString('zh-CN');
      
      const item = document.createElement('div');
      item.className = 'hist-item' + (isActive ? ' active' : '');
      item.innerHTML = `
        <div class="hist-meta">
          <strong>#${cfg.id}</strong> Â· ${date} ${isActive ? '<span style="color:#22c55e">â— å½“å‰ä½¿ç”¨</span>' : ''}
        </div>
        <div class="hist-content">
          <strong>æ¨¡å¼:</strong> ${cfg.modes.join(', ')}<br>
          <strong>åˆ·æ–°:</strong> ${cfg.refresh_strategy === 'random' ? 'éšæœº' : 'å¾ªç¯'} / ${cfg.refresh_interval}åˆ†é’Ÿ<br>
          <strong>åŸå¸‚:</strong> ${cfg.city} Â· <strong>AI:</strong> ${cfg.llm_provider}/${cfg.llm_model}
        </div>
        <div class="hist-actions">
          <button onclick="useHistoryConfig(${cfg.id})">ğŸ“ ç¼–è¾‘æ­¤é…ç½®</button>
          ${!isActive ? `<button onclick="activateConfig(${cfg.id})">âœ“ ä½¿ç”¨æ­¤é…ç½®</button>` : ''}
        </div>
      `;
      historyList.appendChild(item);
    });
    
    historyList.style.display = 'block';
    document.getElementById('configForm').style.display = 'none';
  } catch (e) {
    showAlert('åŠ è½½å¤±è´¥: ' + e.message, 'error');
  }
}

async function useHistoryConfig(configId) {
  const mac = document.getElementById('macIn').value.trim();
  
  try {
    const res = await fetch(`${API_BASE}/api/config/${mac}/history`);
    const data = await res.json();
    const cfg = data.configs.find(c => c.id === configId);
    
    if (!cfg) {
      showAlert('é…ç½®ä¸å­˜åœ¨', 'error');
      return;
    }
    
    fillForm(cfg);
    document.getElementById('configForm').style.display = 'block';
    document.getElementById('historyList').style.display = 'none';
    showAlert('å·²åŠ è½½å†å²é…ç½®ï¼Œå¯ä»¥ç¼–è¾‘åä¿å­˜', 'info');
  } catch (e) {
    showAlert('åŠ è½½å¤±è´¥: ' + e.message, 'error');
  }
}

async function activateConfig(configId) {
  const mac = document.getElementById('macIn').value.trim();
  
  if (!confirm('ç¡®å®šè¦æ¿€æ´»æ­¤é…ç½®å—ï¼Ÿ\n\nè®¾å¤‡å°†åœ¨ä¸‹æ¬¡åˆ·æ–°æ—¶åº”ç”¨ã€‚')) {
    return;
  }
  
  try {
    const res = await fetch(`${API_BASE}/api/config/${mac}/activate/${configId}`, {
      method: 'PUT'
    });
    
    if (!res.ok) throw new Error('æ¿€æ´»å¤±è´¥');
    
    if (confirm('âœ“ é…ç½®å·²æ¿€æ´»ï¼\n\nè®¾å¤‡å°†åœ¨ä¸‹æ¬¡åˆ·æ–°æ—¶åº”ç”¨æ–°é…ç½®ã€‚\n\nç‚¹å‡»"ç¡®å®š"ç»§ç»­')) {
      // User clicked OK
    }
    loadHistory(); // åˆ·æ–°åˆ—è¡¨
  } catch (e) {
    if (confirm('âœ— æ¿€æ´»å¤±è´¥\n\n' + e.message + '\n\nç‚¹å‡»"ç¡®å®š"ç»§ç»­')) {
      // User clicked OK
    }
  }
}

function fillForm(cfg) {
  document.getElementById('nickname').value = cfg.nickname || '';
  document.getElementById('city').value = cfg.city || 'æ­å·';
  document.getElementById('interval').value = cfg.refresh_interval || 60;
  
  // Modes
  document.querySelectorAll('#modes .ch').forEach(el => {
    el.classList.remove('sel');
    if (cfg.modes.includes(el.dataset.m)) el.classList.add('sel');
  });
  
  // Strategy
  document.querySelectorAll('#strategy .pi').forEach(el => {
    el.classList.remove('sel');
    if (el.dataset.v === cfg.refresh_strategy) el.classList.add('sel');
  });
  
  // Language
  document.querySelectorAll('#language .pi').forEach(el => {
    el.classList.remove('sel');
    if (el.dataset.v === cfg.language) el.classList.add('sel');
  });
  
  // Tone
  document.querySelectorAll('#tone .pi').forEach(el => {
    el.classList.remove('sel');
    if (el.dataset.v === cfg.content_tone) el.classList.add('sel');
  });
  
  // Character Tones
  document.querySelectorAll('#configForm .tc .ch').forEach(el => {
    el.classList.remove('sel');
    if (cfg.character_tones && cfg.character_tones.includes(el.dataset.t)) el.classList.add('sel');
  });
  
  // Custom tone
  const customTones = (cfg.character_tones || []).filter(t => 
    !['é²è¿…','ç‹å°æ³¢','å¼ çˆ±ç²','æ‘ä¸Šæ˜¥æ ‘','ç‹å®¶å«','å‘¨æ˜Ÿé©°','ç”„å¬›','ç™½å±•å ‚','è‹æ ¼æ‹‰åº•','åº„å­','å°¼é‡‡','JARVIS','æ™ºå­','é©¬æ–‡'].includes(t)
  );
  if (customTones.length > 0) {
    document.getElementById('custTone').value = customTones.join(', ');
  }
  
  // LLM
  document.getElementById('llmProvider').value = cfg.llm_provider || 'deepseek';
  updateModels();
  document.getElementById('llmModel').value = cfg.llm_model || 'deepseek-chat';

  // Countdown events
  fillCountdownEvents(cfg.countdown_events || cfg.countdownEvents || []);
}

async function saveConfig() {
  const mac = document.getElementById('macIn').value.trim();
  if (!mac) {
    showAlert('è¯·è¾“å…¥ MAC åœ°å€', 'error');
    return;
  }

  const modes = [];
  document.querySelectorAll('#modes .ch.sel').forEach(el => modes.push(el.dataset.m));
  
  if (modes.length === 0) {
    showAlert('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªå†…å®¹æ¨¡å¼', 'error');
    return;
  }

  const characterTones = [];
  document.querySelectorAll('#configForm .tc .ch.sel').forEach(el => characterTones.push(el.dataset.t));
  const custTone = document.getElementById('custTone').value.trim();
  if (custTone) {
    custTone.split(/[,ï¼Œã€]/).forEach(t => {
      const trimmed = t.trim();
      if (trimmed) characterTones.push(trimmed);
    });
  }

  const data = {
    mac: mac,
    nickname: document.getElementById('nickname').value.trim(),
    modes: modes,
    refreshStrategy: document.querySelector('#strategy .pi.sel')?.dataset.v || 'random',
    characterTones: characterTones,
    language: document.querySelector('#language .pi.sel')?.dataset.v || 'zh',
    contentTone: document.querySelector('#tone .pi.sel')?.dataset.v || 'neutral',
    city: document.getElementById('city').value.trim() || 'æ­å·',
    llmProvider: document.getElementById('llmProvider').value,
    llmModel: document.getElementById('llmModel').value,
    refreshInterval: parseInt(document.getElementById('interval').value) || 60,
    countdownEvents: getCountdownEvents()
  };

  try {
    const res = await fetch(`${API_BASE}/api/config`, {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify(data)
    });

    if (!res.ok) throw new Error('ä¿å­˜å¤±è´¥');
    
    if (confirm('âœ“ é…ç½®ä¿å­˜æˆåŠŸï¼\n\nè®¾å¤‡å°†åœ¨ä¸‹æ¬¡åˆ·æ–°æ—¶åº”ç”¨æ–°é…ç½®ã€‚\n\nç‚¹å‡»"ç¡®å®š"ç»§ç»­')) {
      // User clicked OK, do nothing
    }
  } catch (e) {
    if (confirm('âœ— ä¿å­˜å¤±è´¥\n\n' + e.message + '\n\nç‚¹å‡»"ç¡®å®š"ç»§ç»­')) {
      // User clicked OK, do nothing
    }
  }
}

// Countdown events management
function addCountdownEvent(name='', date='', type='countdown') {
  const container = document.getElementById('countdownEvents');
  const count = container.children.length;
  if (count >= 10) { showAlert('æœ€å¤šæ·»åŠ  10 ä¸ªäº‹ä»¶', 'error'); return; }

  const row = document.createElement('div');
  row.style.cssText = 'display:flex;gap:6px;align-items:center;margin-bottom:6px';
  row.innerHTML = `
    <input type="text" class="inp cd-name" placeholder="äº‹ä»¶åç§°" value="${name}" style="flex:2">
    <input type="date" class="inp cd-date" value="${date}" style="flex:2">
    <select class="sel cd-type" style="flex:1;padding:8px"><option value="countdown" ${type==='countdown'?'selected':''}>å€’è®¡æ—¶</option><option value="countup" ${type==='countup'?'selected':''}>æ­£è®¡æ—¥</option></select>
    <button onclick="this.parentElement.remove()" style="padding:6px 10px;border:1px solid var(--bd);border-radius:6px;cursor:pointer;background:#fff;color:#dc2626;font-size:.8rem">âœ•</button>
  `;
  container.appendChild(row);
}

function getCountdownEvents() {
  const events = [];
  document.querySelectorAll('#countdownEvents > div').forEach(row => {
    const name = row.querySelector('.cd-name').value.trim();
    const date = row.querySelector('.cd-date').value;
    const type = row.querySelector('.cd-type').value;
    if (name && date) events.push({ name, date, type });
  });
  return events;
}

function fillCountdownEvents(events) {
  const container = document.getElementById('countdownEvents');
  container.innerHTML = '';
  (events || []).forEach(evt => {
    addCountdownEvent(evt.name || '', evt.date || '', evt.type || 'countdown');
  });
}

// Initialize
updateModels();

// Auto-load config from URL parameter
const urlParams = new URLSearchParams(window.location.search);
const macParam = urlParams.get('mac');
if (macParam) {
  document.getElementById('macIn').value = macParam;
  loadConfig();
}
</script>
</body>
</html>

